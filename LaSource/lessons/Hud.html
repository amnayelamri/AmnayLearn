<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Audio Lesson - Quran Learning</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 28px;
            margin-bottom: 10px;
        }

        .header p {
            opacity: 0.9;
            font-size: 14px;
        }

        .content {
            padding: 30px;
        }

        .audio-player-section {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
        }

        audio {
            width: 100%;
            border-radius: 8px;
            margin-bottom: 15px;
        }

        .timeline {
            position: relative;
            height: 60px;
            background: #e0e0e0;
            border-radius: 8px;
            margin-bottom: 20px;
            overflow: hidden;
            cursor: pointer;
        }

        .timeline-progress {
            position: absolute;
            top: 0;
            left: 0;
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            opacity: 0.4;
            pointer-events: none;
        }

        .marker {
            position: absolute;
            top: 0;
            width: 4px;
            height: 100%;
            background: #ff4757;
            cursor: pointer;
            transition: width 0.2s;
        }

        .marker:hover {
            width: 8px;
        }

        .marker-label {
            position: absolute;
            top: -25px;
            left: 50%;
            transform: translateX(-50%);
            background: #ff4757;
            color: white;
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 11px;
            white-space: nowrap;
            pointer-events: none;
        }

        .controls {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }

        .btn-secondary {
            background: #f0f0f0;
            color: #333;
        }

        .btn-secondary:hover {
            background: #e0e0e0;
        }

        .time-display {
            font-size: 18px;
            font-weight: 600;
            color: #667eea;
            margin-bottom: 20px;
            text-align: center;
        }

        .markers-list {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 20px;
            margin-top: 20px;
        }

        .markers-list h3 {
            margin-bottom: 15px;
            color: #555;
        }

        .marker-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 12px;
            background: white;
            border-radius: 6px;
            margin-bottom: 10px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
        }

        .marker-info {
            flex: 1;
        }

        .marker-time {
            font-weight: 600;
            color: #667eea;
        }

        .marker-duration {
            font-size: 12px;
            color: #888;
            margin-top: 4px;
        }

        .marker-actions {
            display: flex;
            gap: 5px;
        }

        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
        }

        .pause-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .pause-overlay.active {
            display: flex;
        }

        .pause-message {
            background: white;
            padding: 40px;
            border-radius: 16px;
            text-align: center;
            max-width: 400px;
        }

        .pause-message h2 {
            color: #667eea;
            margin-bottom: 20px;
        }

        .countdown {
            font-size: 48px;
            font-weight: bold;
            color: #ff4757;
            margin: 20px 0;
        }

        .alert {
            padding: 12px;
            border-radius: 6px;
            margin-bottom: 15px;
            font-size: 14px;
        }

        .alert-success {
            background: #e8f5e9;
            color: #2e7d32;
            border-left: 4px solid #4caf50;
        }

        .alert-info {
            background: #e3f2fd;
            color: #1565c0;
            border-left: 4px solid #2196f3;
        }

        .instructions {
            background: #fff9e6;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin-bottom: 20px;
            border-radius: 4px;
            font-size: 13px;
            line-height: 1.8;
        }

        .instructions strong {
            display: block;
            margin-bottom: 8px;
            color: #f57c00;
        }

        .instructions code {
            background: #f0f0f0;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: monospace;
            color: #d32f2f;
        }

        .instructions ol {
            margin-left: 20px;
        }

        .instructions li {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1 id="lesson-title">Loading...</h1>
            <p id="lesson-description">Please wait...</p>
        </div>

        <div class="content">


            <div class="audio-player-section">
                <audio id="audio-player" controls></audio>
                <div class="time-display" id="time-display">00:00 / 00:00</div>
            </div>

            <div class="timeline" id="timeline" onclick="seekTo(event)">
                <div class="timeline-progress" id="timeline-progress"></div>
                <div id="markers-container"></div>
            </div>

            <div class="controls">
                <button class="btn btn-secondary" onclick="jumpToPreviousPause()">⏪ السابق</button>
                <button class="btn btn-secondary" onclick="jumpToNextPause()">⏩ التالي</button>
                <button class="btn btn-primary" onclick="resetLesson()">🔄 إعادة القراءة</button>
            </div>

            <div class="alert alert-info">
                سيتم إيقاف الصوت تلقائيًا عند نقاط محددة. استخدم هذا الوقت لتكرار ما سمعته.
سيُستأنف الصوت تلقائيًا بعد ذلك.
            </div>

            <div class="markers-list">
                <h3>نقاط التوقف في هذا الدرس</h3>
                <div id="markers-list"></div>
            </div>
        </div>
    </div>

    <div class="pause-overlay" id="pause-overlay">
        <div class="pause-message">
            <h2>Repeat</h2>
            <div class="countdown" id="countdown">3</div>
            <p>Resuming automatically...</p>
            <button class="btn btn-primary" onclick="resumeEarly()">Resume Now</button>
        </div>
    </div>

    <script>
        // ========================================
        // ⭐ EDIT THIS SECTION FOR YOUR LESSON ⭐
        // ========================================
        
        const LESSON_CONFIG = {
            // 1️⃣ Lesson Information
            title: "سورة هود",
            description: "بالتلقين",
            
            // 2️⃣ Audio File Name
            // IMPORTANT: This file must be in the SAME FOLDER as this HTML!
            audioFile: "audio/hud.mp3",
            
            // 3️⃣ Markers - Paste your markers here
            // Get these from the audio-pause-trainer.html export
            markers: [
    {
      "time": 40.739663,
      "duration": 3,
      "triggered": false
    },
    {
      "time": 63.696216,
      "duration": 3,
      "triggered": false
    },
    {
      "time": 76.305419,
      "duration": 3,
      "triggered": false
    }
  ]
        };
        
        // ========================================
        // ⛔ DON'T EDIT BELOW THIS LINE
        // ========================================

        let audioPlayer = null;
        let pauseMarkers = [];
        let currentDuration = 0;
        let isInPause = false;
        let pauseTimeout = null;
        let updateInterval = null;

        // Initialize lesson when page loads
        window.addEventListener('DOMContentLoaded', initializeLesson);

        function initializeLesson() {
            try {
                // Set title and description
                document.getElementById('lesson-title').textContent = LESSON_CONFIG.title;
                document.getElementById('lesson-description').textContent = LESSON_CONFIG.description;
                
                // Load markers
                pauseMarkers = LESSON_CONFIG.markers;
                console.log(`Loaded ${pauseMarkers.length} markers`);
                
                // Initialize audio player
                audioPlayer = document.getElementById('audio-player');
                audioPlayer.src = LESSON_CONFIG.audioFile;
                
                // Set up event listeners
                audioPlayer.addEventListener('loadedmetadata', onAudioReady);
                audioPlayer.addEventListener('timeupdate', onTimeUpdate);
                audioPlayer.addEventListener('play', startUpdateInterval);
                audioPlayer.addEventListener('pause', stopUpdateInterval);
                audioPlayer.addEventListener('ended', stopUpdateInterval);
                audioPlayer.addEventListener('error', onAudioError);
                
            } catch (error) {
                console.error('Error loading lesson:', error);
                document.getElementById('status-message').textContent = 
                    '❌ Error: ' + error.message;
                document.getElementById('status-message').className = 'alert alert-danger';
                document.getElementById('status-message').style.background = '#ffebee';
                document.getElementById('status-message').style.color = '#c62828';
            }
        }

        function onAudioReady() {
            currentDuration = audioPlayer.duration;
            console.log(`Audio loaded successfully. Duration: ${currentDuration}s`);
            renderMarkers();
            updateTimeline();
        }

        function onAudioError(e) {
            const errorMessages = {
                1: 'Audio loading was aborted',
                2: 'Network error while loading audio',
                3: 'Audio file is corrupted or format not supported',
                4: 'Audio file not found. Make sure the file is in the same folder as this HTML!'
            };
            
            const errorCode = audioPlayer.error ? audioPlayer.error.code : 0;
            const errorMsg = errorMessages[errorCode] || 'Unknown error loading audio';
            
            document.getElementById('status-message').textContent = `❌ ${errorMsg}`;
            document.getElementById('status-message').className = 'alert';
            document.getElementById('status-message').style.background = '#ffebee';
            document.getElementById('status-message').style.color = '#c62828';
            
            console.error('Audio error:', errorMsg);
        }

        function onTimeUpdate() {
            updateTimeline();
            checkForPause();
        }

        function startUpdateInterval() {
            stopUpdateInterval();
            updateInterval = setInterval(() => {
                updateTimeline();
                checkForPause();
            }, 100);
        }

        function stopUpdateInterval() {
            if (updateInterval) {
                clearInterval(updateInterval);
                updateInterval = null;
            }
        }

        function updateTimeline() {
            if (!audioPlayer) return;
            
            const currentTime = audioPlayer.currentTime;
            const duration = audioPlayer.duration || 0;
            
            if (duration > 0) {
                const progress = (currentTime / duration) * 100;
                document.getElementById('timeline-progress').style.width = progress + '%';
                
                const currentMinutes = Math.floor(currentTime / 60);
                const currentSeconds = Math.floor(currentTime % 60);
                const durationMinutes = Math.floor(duration / 60);
                const durationSeconds = Math.floor(duration % 60);
                
                document.getElementById('time-display').textContent = 
                    `${pad(currentMinutes)}:${pad(currentSeconds)} / ${pad(durationMinutes)}:${pad(durationSeconds)}`;
            }
        }

        function pad(num) {
            return num.toString().padStart(2, '0');
        }

        function checkForPause() {
            if (isInPause || !audioPlayer) return;

            const currentTime = audioPlayer.currentTime;
            
            for (let i = 0; i < pauseMarkers.length; i++) {
                const marker = pauseMarkers[i];
                if (currentTime >= marker.time && currentTime < marker.time + 0.1 && !marker.triggered) {
                    marker.triggered = true;
                    triggerPause(marker.duration);
                    
                    setTimeout(() => {
                        marker.triggered = false;
                    }, 4000);
                    break;
                }
            }
        }

        function triggerPause(duration) {
            isInPause = true;
            audioPlayer.pause();
            
            document.getElementById('pause-overlay').classList.add('active');
            
            let countdown = duration;
            document.getElementById('countdown').textContent = countdown;
            
            const countdownInterval = setInterval(() => {
                countdown--;
                if (countdown > 0) {
                    document.getElementById('countdown').textContent = countdown;
                } else {
                    clearInterval(countdownInterval);
                }
            }, 1000);
            
            pauseTimeout = setTimeout(() => {
                resumeEarly();
            }, duration * 1000);
        }

        function resumeEarly() {
            if (pauseTimeout) {
                clearTimeout(pauseTimeout);
                pauseTimeout = null;
            }
            
            document.getElementById('pause-overlay').classList.remove('active');
            isInPause = false;
            audioPlayer.play();
        }

        function renderMarkers() {
            const container = document.getElementById('markers-container');
            const list = document.getElementById('markers-list');
            container.innerHTML = '';
            list.innerHTML = '';
            
            if (pauseMarkers.length === 0) {
                list.innerHTML = '<p style="color: #999; text-align: center;">No pause markers</p>';
                return;
            }
            
            const duration = audioPlayer.duration || 100;
            
            pauseMarkers.forEach((marker, index) => {
                // Timeline marker
                const markerEl = document.createElement('div');
                markerEl.className = 'marker';
                markerEl.style.left = (marker.time / duration * 100) + '%';
                markerEl.onclick = (e) => {
                    e.stopPropagation();
                    audioPlayer.currentTime = marker.time;
                };
                
                const label = document.createElement('div');
                label.className = 'marker-label';
                label.textContent = `${marker.duration}s`;
                markerEl.appendChild(label);
                
                container.appendChild(markerEl);
                
                // List item
                const itemEl = document.createElement('div');
                itemEl.className = 'marker-item';
                itemEl.innerHTML = `
                    <div class="marker-info">
                        <div class="marker-time">${formatTime(marker.time)}</div>
                        <div class="marker-duration">⏸️ التوقف لمدة ${marker.duration} ثوانٍ </div>
                    </div>
                    <div class="marker-actions">
                        <button class="btn btn-secondary btn-small" onclick="audioPlayer.currentTime = ${marker.time+0.2}">▶️ ابدأ</button>
                    </div>
                `;
                list.appendChild(itemEl);
            });
        }

        function formatTime(seconds) {
            const mins = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            return `${pad(mins)}:${pad(secs)}`;
        }

        function jumpToPreviousPause() {
            if (pauseMarkers.length === 0 || !audioPlayer) return;
            
            const currentTime = audioPlayer.currentTime;
            
            for (let i = pauseMarkers.length - 1; i >= 0; i--) {
                if (pauseMarkers[i].time < currentTime - 1) {
                    audioPlayer.currentTime = pauseMarkers[i].time+0.2;
                    return;
                }
            }
            
            audioPlayer.currentTime = pauseMarkers[pauseMarkers.length - 1].time;
        }

        function jumpToNextPause() {
            if (pauseMarkers.length === 0 || !audioPlayer) return;
            
            const currentTime = audioPlayer.currentTime;
            
            for (let i = 0; i < pauseMarkers.length; i++) {
                if (pauseMarkers[i].time > currentTime + 1) {
                    audioPlayer.currentTime = pauseMarkers[i].time+ 0.2;
                    return;
                }
            }
        }

        function resetLesson() {
            if (!audioPlayer) return;
            audioPlayer.currentTime = 0;
            pauseMarkers.forEach(m => m.triggered = false);
        }

        function seekTo(event) {
            if (!audioPlayer) return;
            
            const timeline = document.getElementById('timeline');
            const rect = timeline.getBoundingClientRect();
            const x = event.clientX - rect.left;
            const percentage = x / rect.width;
            const time = percentage * audioPlayer.duration;
            audioPlayer.currentTime = time;
        }
    </script>
</body>
</html>